# AI 어시스턴트 통합 그룹웨어 아키텍처 문서

## 개요

솔트룩스 AI 어시스턴트 통합 그룹웨어는 React 기반 프론트엔드와 Node.js 기반 백엔드로 구성된 풀스택 애플리케이션입니다.

## 시스템 아키텍처

### 전체 구조

```
┌─────────────────┐
│   Frontend      │
│   (React)       │
└────────┬────────┘
         │ HTTP/WebSocket
         │
┌────────▼────────┐
│   Backend       │
│   (Node.js)     │
└────────┬────────┘
         │
    ┌────┴────┬──────────┬──────────┐
    │         │          │          │
┌───▼───┐ ┌──▼───┐ ┌────▼────┐ ┌──▼──┐
│  DB   │ │ Redis│ │  Docker  │ │ S3   │
│(PG)   │ │Cache │ │Executor │ │Storage│
└───────┘ └──────┘ └─────────┘ └──────┘
```

## 백엔드 아키텍처

### 계층 구조

```
┌─────────────────────────────────────┐
│         Routes Layer                │
│  (API 엔드포인트, 요청 라우팅)        │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│      Middleware Layer                │
│  (인증, 검증, Rate Limiting, 메트릭)  │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│       Services Layer                │
│  (비즈니스 로직, AI 오케스트레이션)    │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│        Utils Layer                  │
│  (로깅, 암호화, 캐싱, 메트릭)         │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│      Data Access Layer              │
│  (Prisma ORM, Database)             │
└─────────────────────────────────────┘
```

## 주요 컴포넌트

### 1. 인증 시스템

- **JWT 기반 인증**: 이메일/비밀번호 로그인
- **비밀번호 해싱**: bcrypt 사용
- **토큰 갱신**: 자동 토큰 갱신 지원

### 2. AI 오케스트레이션

- **다중 AI 프로바이더**: OpenAI, Claude, Gemini, Perplexity, Luxia
- **라우팅 알고리즘**: 프롬프트 의도 분석 기반 자동 라우팅
- **가중치 관리**: 관리자가 설정한 가중치 기반 프로바이더 선택
- **Circuit Breaker**: 프로바이더 장애 시 자동 폴백
- **캐싱**: API 응답 캐싱으로 비용 절감

### 3. 코드 실행 시스템

- **Docker 샌드박스**: 격리된 환경에서 Python 코드 실행
- **보안 검증**: AST 기반 정적 분석 및 패턴 검증
- **리소스 제한**: 메모리, CPU, 프로세스 수 제한

### 4. 워크플로우 엔진

- **자동 계획 수립**: AI 기반 워크플로우 계획 생성
- **단계별 실행**: 의존성 기반 순차 실행
- **재시도 로직**: Exponential backoff 기반 자동 재시도
- **알림**: 워크플로우 상태 변경 시 이메일/Slack 알림

### 5. 문서 처리

- **다양한 형식 지원**: PDF, DOCX, XLSX, TXT
- **AI 기반 요약**: 문서 내용 요약
- **통계 생성**: 문서 통계 분석
- **새 문서 생성**: 기존 문서 기반 새 문서 생성

### 6. 모니터링 및 알림

- **Prometheus 메트릭**: HTTP, AI, 코드 실행, 워크플로우 메트릭
- **이메일 알림**: SMTP 기반 오류 및 시스템 알림
- **Slack 알림**: 웹훅 기반 실시간 알림

## 데이터베이스 스키마

### 주요 테이블

- **users**: 사용자 정보
- **conversations**: 대화 세션
- **messages**: 메시지
- **documents**: 문서 메타데이터
- **api_keys**: AI API 키 (암호화 저장)
- **workflows**: 워크플로우
- **logs**: 시스템 로그
- **guardrails**: 프롬프트 가드레일

## 보안 기능

### 1. 인증 및 권한

- JWT 토큰 기반 인증
- 역할 기반 접근 제어 (RBAC)
- 관리자 전용 API

### 2. 데이터 보안

- API 키 AES-256-GCM 암호화
- 비밀번호 bcrypt 해싱
- 입력 검증 (Zod 스키마)

### 3. 코드 실행 보안

- Docker 컨테이너 격리
- 네트워크 비활성화
- 읽기 전용 파일시스템
- 리소스 제한

### 4. 네트워크 보안

- CORS 설정
- Rate Limiting
- 보안 헤더 (XSS, Clickjacking 방어)

## 성능 최적화

### 1. 캐싱 전략

- Redis 기반 API 응답 캐싱
- 세션 캐싱
- 캐시 TTL 관리

### 2. 데이터베이스 최적화

- Prisma 연결 풀
- 인덱스 최적화
- 쿼리 최적화

### 3. 비동기 처리

- 비동기 로깅
- Promise 기반 비동기 작업
- 이벤트 기반 알림

## 확장성

### 수평 확장

- Stateless 백엔드 설계
- Redis를 통한 세션 공유
- 로드 밸런서 지원

### 수직 확장

- 메모리 기반 캐싱
- 연결 풀 최적화
- 리소스 모니터링

## 배포 아키텍처

### Docker Compose 구성

- Frontend (React)
- Backend (Node.js)
- PostgreSQL
- Redis
- Code Executor (Docker)

### 환경 변수

- 데이터베이스 연결 정보
- API 키 (암호화 마스터 키)
- SMTP 설정
- Slack 웹훅 URL
- AWS S3 설정

## 모니터링 및 로깅

### 로깅

- Winston 기반 구조화된 로깅
- 데이터베이스 로깅
- 파일 로깅
- 사용자 행동 추적

### 메트릭

- Prometheus 메트릭 수집
- HTTP 요청 메트릭
- AI API 메트릭
- 코드 실행 메트릭
- 워크플로우 메트릭

## 향후 개선 사항

1. **스트리밍 응답**: Server-Sent Events 구현
2. **오프라인 지원**: Service Worker 기반 오프라인 모드
3. **테스트 커버리지**: Unit, Integration, E2E 테스트 확대
4. **API 문서화**: Swagger/OpenAPI 완성도 향상
5. **성능 모니터링**: APM 도구 통합

